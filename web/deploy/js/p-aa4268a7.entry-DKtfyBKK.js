import{o as j,V as X,m as O,D as v,L as B,T as N}from"./lf-core-C0TwNeAf.js";import{au as $,C as q,c as J,av as Y,l as K,n as Q,aw as Z,ax as y}from"./theme.constants-_3bg_1Hx.js";import{o as ee}from"./p-558ec216-av2_KWVh.js";import"./preload-helper-C1FmrZbK.js";const I=async(e,t=null)=>{const{history:s}=e.controller.set;t===null?(s.pop(),C(e)):s.pop(t)},C=async e=>{const{controller:t,elements:s}=e,{masonry:a}=s.refs.navigation,{set:i}=t;i.currentShape({}),i.history.index(null),a.setSelectedShape(null)},M=e=>{const{compInstance:t,currentShape:s,manager:a}=e.controller.get,{lfDataset:i}=t,{getAll:r}=a.data.cell.shapes,c=s();return r(i,!1).image.find(d=>d.value===c.value||d.lfValue===c.value)},z=async(e,t)=>{requestAnimationFrame(()=>e.lfShowSpinner=!0),await t(),requestAnimationFrame(()=>e.lfShowSpinner=!1)},U=(e,t)=>{const s=e;e.value=t,s.lfValue&&(s.lfValue=t)},te=e=>({canvas:()=>{const{controller:t,elements:s,handlers:a}=e(),{blocks:i,history:r,lfAttribute:c,manager:d}=t.get,{details:f}=s.refs,{canvas:l}=a.details,{currentSnapshot:o}=r,{assignRef:h,theme:u}=d,{bemClass:g}=u,m=o();if(m)return v("lf-canvas",{class:g(i.detailsGrid._,i.detailsGrid.canvas),"data-lf":c.fadeIn,id:y.details.canvas,lfImageProps:{lfValue:m.value},"onLf-canvas-event":l,ref:h(f,"canvas")})},clearHistory:()=>{var p;const{controller:t,elements:s,handlers:a}=e(),{blocks:i,cyAttributes:r,history:c,manager:d}=t.get,{details:f}=s.refs,{button:l}=a.details,{current:o}=c,{assignRef:h,theme:u}=d,{bemClass:g,get:m}=u,b=m.icon("stackPop"),x=!(((p=o())==null?void 0:p.length)>1);return v("lf-button",{class:g(i.detailsGrid._,i.detailsGrid.clearHistory),"data-cy":r.button,id:y.details.clearHistory,lfIcon:b,lfLabel:"Clear history",lfStretchX:!0,lfStyling:"flat",lfUiState:x?"disabled":"danger","onLf-button-event":l,ref:h(f,"clearHistory")})},deleteShape:()=>{const{controller:t,elements:s,handlers:a}=e(),{blocks:i,cyAttributes:r,manager:c}=t.get,{details:d}=s.refs,{button:f}=a.details,{assignRef:l,theme:o}=c,{bemClass:h,get:u}=o,{"--lf-icon-clear":g}=u.current().variables;return v("lf-button",{class:h(i.detailsGrid._,i.detailsGrid.delete),"data-cy":r.button,id:y.details.deleteShape,lfIcon:g,lfLabel:"Delete image",lfStretchX:!0,lfUiState:"danger","onLf-button-event":f,ref:l(d,"deleteShape")})},redo:()=>{const{controller:t,elements:s,handlers:a}=e(),{blocks:i,cyAttributes:r,history:c,manager:d}=t.get,{current:f,index:l}=c,{details:o}=s.refs,{button:h}=a.details,{assignRef:u,theme:g}=d,{bemClass:m,get:b}=g,{"--lf-icon-next":x}=b.current().variables,p=f(),k=!(p!=null&&p.length&&l()<p.length-1);return v("lf-button",{class:m(i.detailsGrid._,i.detailsGrid.redo),"data-cy":r.button,id:y.details.redo,lfIcon:x,lfLabel:"Redo",lfStretchX:!0,lfStyling:"flat",lfUiState:k?"disabled":"primary","onLf-button-event":h,ref:u(o,"redo")})},save:()=>{var p;const{controller:t,elements:s,handlers:a}=e(),{blocks:i,cyAttributes:r,history:c,manager:d}=t.get,{current:f}=c,{details:l}=s.refs,{button:o}=a.details,{assignRef:h,theme:u}=d,{bemClass:g,get:m}=u,{"--lf-icon-success":b}=m.current().variables,x=!(((p=f())==null?void 0:p.length)>1);return v("lf-button",{class:g(i.detailsGrid._,i.detailsGrid.commitChanges),"data-cy":r.button,id:y.details.save,lfIcon:b,lfLabel:"Save snapshot",lfStretchX:!0,lfUiState:x?"disabled":"success","onLf-button-event":o,ref:h(l,"save")})},spinner:()=>{const{controller:t,elements:s}=e(),{blocks:a,manager:i,spinnerStatus:r}=t.get,{details:c}=s.refs,{assignRef:d,theme:f}=i,{bemClass:l}=f;return v("lf-spinner",{class:l(a.detailsGrid._,a.detailsGrid.spinner),id:y.details.spinner,lfActive:r(),lfDimensions:"16px",lfFader:!0,lfFaderTimeout:125,lfLayout:14,ref:d(c,"save")})},tree:()=>{const{controller:t,elements:s,handlers:a}=e(),{blocks:i,compInstance:r,cyAttributes:c,manager:d}=t.get,{details:f}=s.refs,{tree:l}=a.details,{assignRef:o,theme:h}=d,{bemClass:u}=h;return v("lf-tree",{class:u(i.detailsGrid._,i.detailsGrid.tree),"data-cy":c.input,id:y.details.tree,lfAccordionLayout:!0,lfDataset:r.lfValue,lfFilter:!1,lfSelectable:!0,lfUiSize:"small","onLf-tree-event":l,ref:o(f,"tree")})},undo:()=>{var k;const{controller:t,elements:s,handlers:a}=e(),{blocks:i,cyAttributes:r,history:c,manager:d}=t.get,{current:f,index:l}=c,{details:o}=s.refs,{button:h}=a.details,{assignRef:u,theme:g}=d,{bemClass:m,get:b}=g,{"--lf-icon-previous":x}=b.current().variables,p=!((k=f())!=null&&k.length&&l()>0);return v("lf-button",{class:m(i.detailsGrid._,i.detailsGrid.undo),"data-cy":r.button,id:y.details.undo,lfIcon:x,lfLabel:"Undo",lfStretchX:!0,lfStyling:"flat",lfUiState:p?"disabled":"primary","onLf-button-event":h,ref:u(o,"undo")})}}),se=e=>({load:()=>{const{controller:t,elements:s,handlers:a}=e(),{blocks:i,cyAttributes:r,manager:c}=t.get,{navigation:d}=s.refs,{button:f}=a.navigation,{assignRef:l,theme:o}=c,{bemClass:h}=o;return v("lf-button",{class:h(i.navigationGrid._,i.navigationGrid.button),"data-cy":r.button,id:y.navigation.load,lfLabel:"Load",lfStretchX:!0,"onLf-button-event":f,ref:l(d,"load")},v("lf-spinner",{lfActive:!0,lfDimensions:"2px",lfLayout:1,slot:"spinner"}))},masonry:()=>{const{controller:t,elements:s,handlers:a}=e(),{blocks:i,compInstance:r,manager:c}=t.get,{navigation:d}=s.refs,{masonry:f}=a.navigation,{lfDataset:l}=r,{assignRef:o,theme:h}=c,{bemClass:u}=h;return v("lf-masonry",{class:u(i.navigationGrid._,i.navigationGrid.masonry),id:y.navigation.masonry,lfActions:!0,lfDataset:l,lfSelectable:!0,"onLf-masonry-event":f,ref:o(d,"masonry")})},textfield:()=>{const{controller:t,elements:s,handlers:a}=e(),{blocks:i,cyAttributes:r,manager:c}=t.get,{navigation:d}=s.refs,{textfield:f}=a.navigation,{assignRef:l,theme:o}=c,{bemClass:h}=o;return v("lf-textfield",{class:h(i.navigationGrid._,i.navigationGrid.textfield),"data-cy":r.input,id:y.navigation.textfield,lfIcon:"folder",lfLabel:"Directory",lfStretchX:!0,lfStyling:"flat","onLf-textfield-event":f,ref:l(d,"textfield")})}}),ie=e=>({button:async t=>{const{comp:s,eventType:a,id:i}=t.detail,r=e(),{compInstance:c,currentShape:d}=r.controller.get;if(c.onLfEvent(t,"lf-event"),a==="click")switch(i){case y.details.clearHistory:const f=d().shape.index;z(s,async()=>I(r,f));break;case y.details.deleteShape:z(s,()=>(async l=>{const{compInstance:o,currentShape:h,manager:u}=l.controller.get,{lfDataset:g}=o,{findNodeByCell:m,pop:b}=u.data.node;await I(l,h().shape.index);const x=m(g,M(l));b(g.nodes,x),o.lfDataset={...g},await C(l)})(r));break;case y.details.redo:z(s,()=>(async l=>{const{controller:o}=l,{get:h,set:u}=o,{current:g,index:m}=h.history,b=g(),x=m();b&&x<b.length-1&&u.history.index(x+1)})(r));break;case y.details.save:z(s,()=>(async l=>{const{compInstance:o,currentShape:h,history:u}=l.controller.get,{lfDataset:g}=o,m=h();if(!m)return;const b=m.shape.index,x=m.shape.shape,p=u.currentSnapshot().value,k=M(l);k.value=p,k.lfValue=p,U(x,p),await I(l,b),o.lfDataset={...g}})(r));break;case y.details.undo:z(s,()=>(async l=>{const{controller:o}=l,{get:h,set:u}=o,{history:g}=h,{index:m}=g,b=m();b>0&&u.history.index(b-1)})(r))}},canvas:t=>{const s=e(),{compInstance:a}=s.controller.get;a.onLfEvent(t,"lf-event")},tree:t=>{const s=e(),{compInstance:a}=s.controller.get;a.onLfEvent(t,"lf-event")}}),ae=e=>({button:async t=>{const{comp:s,eventType:a}=t.detail,i=e(),{compInstance:r}=i.controller.get;r.onLfEvent(t,"lf-event"),a==="click"&&z(s,()=>(async c=>{const{controller:d,elements:f}=c,{textfield:l}=f.refs.navigation,{compInstance:o}=d.get,{lfLoadCallback:h}=o;try{await h(o,await l.getValue()),I(c)}catch(u){console.error("Load operation failed:",u)}})(i))},masonry:t=>{var u;const{eventType:s,originalEvent:a,selectedShape:i}=t.detail,r=e(),{controller:c}=r,{get:d,set:f}=c,{compInstance:l,history:o}=d,{current:h}=o;if(l.onLfEvent(t,"lf-event"),s==="lf-event"&&a.detail.eventType==="click"){const g=d.currentShape();if(((u=g==null?void 0:g.shape)==null?void 0:u.index)===i.index)C(r);else{f.currentShape(i);const m=h();f.history.index(m?m.length-1:0),f.history.new(i)}}},textfield:t=>{const s=e(),{compInstance:a}=s.controller.get;a.onLfEvent(t,"lf-event")}}),ne=(e,t)=>({...e,spinnerStatus:s=>t().elements.refs.details.spinner.lfActive=s}),re=e=>({details:te(e),navigation:se(e)}),le=e=>({details:ie(e),navigation:ae(e)});var _,w,L,A,G,E,R,D,S,T,W,V,H,F,n=function(e,t,s,a){if(s==="a"&&!a)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return s==="m"?a:s==="a"?a.call(e):a?a.value:t.get(e)},P=function(e,t,s,a,i){if(typeof t=="function"?e!==t||!0:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,s),s};const oe=class{constructor(e){j(this,e),this.lfEvent=X(this,"lf-imageviewer-event"),_.add(this),this.currentShape={},this.history={},this.historyIndex=null,this.isSpinnerActive=!1,this.lfDataset={},this.lfLoadCallback=null,this.lfStyle="",this.lfValue={},w.set(this,void 0),L.set(this,$),A.set(this,q),G.set(this,J),E.set(this,Y),R.set(this,K),D.set(this,Q),S.set(this,void 0),T.set(this,()=>{var t;P(this,S,{controller:{get:{blocks:n(this,L,"f"),compInstance:this,currentShape:()=>n(this,_,"m",W).call(this,this.currentShape),cyAttributes:n(this,A,"f"),history:{current:()=>this.history[this.currentShape.index],currentSnapshot:()=>{if(this.historyIndex===null)return null;const s=this.history[this.currentShape.index][this.historyIndex];return n(this,_,"m",W).call(this,s)},full:()=>this.history,index:()=>this.historyIndex},lfAttribute:n(this,G,"f"),manager:n(this,w,"f"),parts:n(this,E,"f"),spinnerStatus:()=>this.isSpinnerActive},set:ne({currentShape:s=>this.currentShape=s,history:{index:s=>this.historyIndex=s,new:(s,a=!1)=>{var r;const i=((r=this.history)==null?void 0:r[s.index])||[];this.historyIndex<i.length-1&&i.splice(this.historyIndex+1),!(i!=null&&i.length)||a?(i.push(s),this.history[s.index]=i,this.historyIndex=i.length-1):i[0]=s},pop:(s=null)=>{s!==null?(this.history[s]=[this.history[s][0]],this.historyIndex===0?this.refresh():this.historyIndex=0):(this.history={},this.historyIndex=null)}}},t=()=>n(this,S,"f"))},elements:{jsx:re(t),refs:{details:{canvas:null,clearHistory:null,deleteShape:null,redo:null,save:null,spinner:null,undo:null,tree:null},navigation:{load:null,masonry:null,textfield:null}}},handlers:le(t)})})}onLfEvent(e,t){this.lfEvent.emit({comp:this,eventType:t,id:this.rootElement.id,originalEvent:e})}async addSnapshot(e){var i;const{currentShape:t}=this;if(!t||!((i=Object.keys(t))!=null&&i.length))return;const{history:s}=n(this,S,"f").controller.set,a=JSON.parse(JSON.stringify(t));U(a.shape,e),s.new(a,!0)}async clearHistory(e=null){await I(n(this,S,"f"),e)}async clearSelection(){await C(n(this,S,"f"))}async getComponents(){return n(this,S,"f").elements.refs}async getCurrentSnapshot(){return n(this,S,"f").controller.get.history.currentSnapshot()}async getDebugInfo(){return this.debugInfo}async getProps(){const e=Z.map(t=>[t,this[t]]);return Object.fromEntries(e)}async refresh(){O(this)}async reset(){await I(n(this,S,"f")),await C(n(this,S,"f"))}async setSpinnerStatus(e){this.isSpinnerActive=e}async unmount(e=0){setTimeout(()=>{this.onLfEvent(new CustomEvent("unmount"),"unmount"),this.rootElement.remove()},e)}connectedCallback(){n(this,w,"f")&&n(this,w,"f").theme.register(this)}async componentWillLoad(){P(this,w,await ee(this)),n(this,T,"f").call(this)}componentDidLoad(){const{info:e}=n(this,w,"f").debug;this.onLfEvent(new CustomEvent("ready"),"ready"),e.update(this,"did-load")}componentWillRender(){const{info:e}=n(this,w,"f").debug;e.update(this,"will-render")}componentDidRender(){const{info:e}=n(this,w,"f").debug;e.update(this,"did-render")}render(){const{bemClass:e,setLfStyle:t}=n(this,w,"f").theme,{lfStyle:s}=this;return v(B,{key:"31127125ef6c2695fe8e7dc80093e4c0444fca5c"},s&&v("style",{key:"f4a2b2343b8875033d828bcbc458e204ea2d14a6",id:n(this,R,"f")},t(this)),v("div",{key:"70d2c83ec8f6fbe2a096abf867f25b37f18dc6b4",id:n(this,D,"f")},v("div",{key:"bd36cb78794586b39c5ed10863bc7b87c39059d2",class:e(n(this,L,"f").imageviewer._),part:n(this,E,"f").imageviewer},n(this,_,"m",H).call(this))))}disconnectedCallback(){var e;(e=n(this,w,"f"))==null||e.theme.unregister(this)}get rootElement(){return N(this)}};w=new WeakMap,L=new WeakMap,A=new WeakMap,G=new WeakMap,E=new WeakMap,R=new WeakMap,D=new WeakMap,S=new WeakMap,T=new WeakMap,_=new WeakSet,W=function(e){const{data:t}=n(this,w,"f"),{cell:s}=t,{stringify:a}=s;return e.index!==void 0?{shape:e,value:a(e.shape.value||e.shape.lfValue)}:null},V=function(){const{bemClass:e}=n(this,w,"f").theme,{detailsGrid:t}=n(this,L,"f"),{canvas:s,clearHistory:a,deleteShape:i,redo:r,save:c,spinner:d,tree:f,undo:l}=n(this,S,"f").elements.jsx.details;return v("div",{class:e(t._),part:n(this,E,"f").details},v("div",{class:e(t._,t.preview)},s(),d()),v("div",{class:e(t._,t.actions)},i(),a(),l(),r(),c()),f(),v("div",{class:e(t._,t.settings)},v("slot",{name:"settings"})))},H=function(){const{bemClass:e}=n(this,w,"f").theme,{currentShape:t}=n(this,S,"f").controller.get;return v("div",{class:e(n(this,L,"f").mainGrid._,null,{selected:!!t()})},n(this,_,"m",F).call(this),n(this,_,"m",V).call(this))},F=function(){const{bemClass:e}=n(this,w,"f").theme,{load:t,masonry:s,textfield:a}=n(this,S,"f").elements.jsx.navigation;return v("div",{class:e(n(this,L,"f").navigationGrid._),part:n(this,E,"f").navigation},a(),t(),s())},oe.style=`::-webkit-scrollbar{width:9px}::-webkit-scrollbar-thumb{transition:all 400ms cubic-bezier(0.8, -0.5, 0.2, 1.4);background-color:rgb(var(--lf-color-primary))}::-webkit-scrollbar-track{background-color:rgb(var(--lf-color-bg))}[data-lf=fade-in]{display:block;animation:lf-fade-in-block 0.25s ease-out forwards}@keyframes lf-fade-in-block{from{visibility:hidden;opacity:0}to{visibility:visible;opacity:1}}:host{display:block;font-family:var(--lf-imageviewer-font-family, var(--lf-font-family-primary));font-size:var(--lf-imageviewer-font-size, var(--lf-font-size))}:host([lf-ui-size=large]){font-size:calc(
        var(--lf-imageviewer-font-size, var(--lf-font-size)) * var(--lf-ui-size-large)
      )}:host([lf-ui-size=medium]){font-size:calc(
        var(--lf-imageviewer-font-size, var(--lf-font-size)) * var(--lf-ui-size-medium)
      )}:host([lf-ui-size=small]){font-size:calc(
        var(--lf-imageviewer-font-size, var(--lf-font-size)) * var(--lf-ui-size-small)
      )}:host([lf-ui-size=xlarge]){font-size:calc(
        var(--lf-imageviewer-font-size, var(--lf-font-size)) * var(--lf-ui-size-xlarge)
      )}:host([lf-ui-size=xsmall]){font-size:calc(
        var(--lf-imageviewer-font-size, var(--lf-font-size)) * var(--lf-ui-size-xsmall)
      )}:host([lf-ui-size=xxlarge]){font-size:calc(
        var(--lf-imageviewer-font-size, var(--lf-font-size)) * var(--lf-ui-size-xxlarge)
      )}:host([lf-ui-size=xxsmall]){font-size:calc(
        var(--lf-imageviewer-font-size, var(--lf-font-size)) * var(--lf-ui-size-xxsmall)
      )}#lf-component{width:100%;height:100%}:host{background-color:rgba(var(--lf-imageviewer-color-bg, var(--lf-color-bg)), 0.125);color:rgb(var(--lf-imageviewer-color-on-bg, var(--lf-color-on-bg)));backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);width:100%;height:100%}.imageviewer{width:100%;height:100%}.main-grid{border:0;border-style:solid;border-color:rgba(var(--lf-imageviewer-border-color, var(--lf-color-border)), 1);border-width:1px;border-radius:var(--lf-imageviewer-border-radius, var(--lf-ui-border-radius));width:100%;height:100%;box-sizing:border-box;display:grid;grid-template-columns:100% 0;overflow:auto}.main-grid--selected{grid-template-columns:30% 70%}.main-grid--selected .details-grid{display:grid}.navigation-grid{width:100%;height:100%;display:grid;grid-template-rows:auto auto 1fr;overflow:auto}.navigation-grid__textfield{padding:0}.navigation-grid__button{padding-bottom:0.75em}.navigation-grid__masonry{overflow:auto;position:relative}.details-grid{width:100%;height:100%;border-left:1px solid var(--lf-color-border);box-sizing:border-box;display:none;grid-template-areas:"image image" "actions actions" "tree settings";grid-template-columns:40% 1fr;grid-template-rows:60% auto 1fr;overflow:auto}.details-grid__actions{border-left:1px solid var(--lf-color-border);box-sizing:border-box;display:flex;grid-area:actions}.details-grid__canvas{border-bottom:1px solid var(--lf-color-border);box-sizing:border-box}.details-grid__preview{grid-area:image;position:relative}.details-grid__spinner{width:100%;height:100%;left:0;pointer-events:none;position:absolute;top:0}.details-grid__tree{border-right:1px solid var(--lf-color-border);box-sizing:border-box;grid-area:tree;overflow:auto}`;export{oe as lf_imageviewer};
