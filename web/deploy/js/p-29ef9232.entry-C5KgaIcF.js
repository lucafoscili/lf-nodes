import{o as fe,V as he,D as h,k as M,m as ue,L as de,T as me}from"./lf-core-C0TwNeAf.js";import{I as O,v as W,w as pe,C as ge,c as be,x as ve,l as ye,n as we,O as ke,y as _e,z as C,A as xe,B as ze,D as Ie,E as Ee,S as Ce,F as Se,H as Le,J as Te,K as oe}from"./theme.constants-_3bg_1Hx.js";import{o as Re}from"./p-558ec216-av2_KWVh.js";import"./preload-helper-C1FmrZbK.js";const w=(a,e)=>{const{currentCharacter:t}=a.controller.get.compInstance;return e??t},Me=(a,e)=>{const{lfEndpointUrl:t,lfMaxTokens:r,lfPollingInterval:s,lfSystem:o,lfTemperature:n}=e;a.lfEndpointUrl=t,a.lfMaxTokens=r,a.lfPollingInterval=s,a.lfSystem=o,a.lfTemperature=n},F=a=>{const{lfDataset:e}=a.controller.get.compInstance;return!!((e==null?void 0:e.nodes)||[]).length},ne=a=>{var t;const{lfDataset:e}=a.controller.get.compInstance;return!!((t=e==null?void 0:e.nodes)!=null&&t.length)},Oe=a=>({biography:e=>Pe(a,e),byId:e=>{const{lfDataset:t}=a().controller.get.compInstance;return t.nodes.find(r=>r.id===e)},chat:e=>De(a,e),current:()=>{const{currentCharacter:e}=a().controller.get.compInstance;return e},history:e=>Ue(a,e),list:()=>{const{lfDataset:e}=a().controller.get.compInstance;return e.nodes||[]},name:e=>Ve(a,e),next:e=>ie(a,e,!0),previous:e=>ie(a,e)}),Ae=a=>({chat:(e,t)=>{const r=a(),{compInstance:s}=r.controller.get,{id:o}=w(a(),t);s.chat[o]=e},current:e=>{const t=a(),{compInstance:r}=t.controller.get;r.currentCharacter=e},history:(e,t)=>{const r=a(),{compInstance:s}=r.controller.get,{id:o}=w(a(),t),n=s;n.history[o]!==e&&(n.history[o]=e,n.lfAutosave&&r.controller.set.data())},next:e=>{const t=a();if(!F(t))return;const{set:r}=t.controller,s=w(a(),e),{next:o}=t.controller.get.character;r.character.current(o(s))},previous:e=>{const t=a();if(!F(t))return;const{set:r}=t.controller,s=w(a(),e),{previous:o}=t.controller.get.character;r.character.current(o(s))}}),Pe=(a,e)=>{const t=a(),{stringify:r}=t.controller.get.manager.data.cell,s=w(a(),e);try{const o=s.children.find(n=>n.id==="biography").value;return o?r(o):"You have no informations about this character..."}catch{return"You have no informations about this character..."}},De=(a,e)=>{const t=a(),{chat:r}=t.controller.get.compInstance,{id:s}=w(t,e);return r[s]},Ue=(a,e)=>{const t=a(),{history:r}=t.controller.get.compInstance,{id:s}=w(a(),e);return r[s]},Ve=(a,e)=>{const{description:t,id:r,value:s}=w(a(),e);return s||r||t||"?"},ie=(a,e,t)=>{const r=a(),{lfDataset:s}=r.controller.get.compInstance,{id:o}=w(a(),e);if(!F(r))return null;const n=s.nodes,i=n.findIndex(l=>l.id===o);return t===!0?n[(i+1)%n.length]:n[(i+n.length-1)%n.length]},je=a=>({asCover:(e,t)=>We(a,e,t),byType:(e,t)=>Fe(a,e,t),coverIndex:(e,t)=>{const r=a(),{covers:s}=r.controller.get.compInstance,{id:o}=w(r,t);return s[o][e]},newId:e=>$e(a,e),root:(e,t)=>{const r=a(),{children:s}=w(r,t);return s.find(o=>o.id===e)},title:e=>{const t=(e==null?void 0:e.value)||"",r=(e==null?void 0:e.description)||"";return t&&r?`${t} - ${r}`:r||t||""}}),Ne=a=>({cover:(e,t,r)=>{const s=a(),{compInstance:o}=s.controller.get,{id:n}=w(a(),r),i=o;i.covers[n][e]=t,i.refresh()}}),We=(a,e,t)=>{const r=a(),{compInstance:s,image:o}=r.controller.get,{children:n,id:i}=w(r,t),{covers:l}=s;try{const c=n.find(p=>p.id===e),u=l[i][e],d=c.children[u];return{node:c.children[u],title:o.title(d),value:d.cells.lfImage.value}}catch{switch(e){case"avatars":return{value:Te};case"locations":return{value:Le};case"outfits":return{value:Se};case"styles":return{value:Ce};case"timeframes":return{value:Ee}}}},Fe=(a,e,t)=>{const{children:r}=w(a(),t),s=r.find(o=>o.id===e);return s!=null&&s.children?s.children:[]},$e=(a,e)=>{const{byType:t}=a().controller.get.image;let r,s,o=0;switch(e){case"avatars":r="avatar_";break;case"locations":r="location_";break;case"outfits":r="outfit_";break;case"styles":r="style_";break;case"timeframes":r="timeframe_";break;default:throw new Error(`Unknown image type: ${e}`)}do s=`${r}${o.toString()}`,o++;while(t(e).some(n=>n.id===s));return s},Ye=a=>()=>{const{ui:e}=a().controller.get.compInstance;return e},Be=a=>({customization:e=>{const{compInstance:t}=a().controller.get,r=t;r.ui.customizationView=e,r.refresh()},filters:e=>{const{compInstance:t}=a().controller.get,r=t;r.ui.filters=e,r.refresh()},options:(e,t)=>{const{compInstance:r}=a().controller.get,s=r;s.ui.options[t]=e,s.refresh()},panel:(e,t)=>Xe(a,e,t),setFormState:async(e,t,r=null)=>Ge(a,e,t,r)}),Ge=async(a,e,t,r)=>{const s=a(),{controller:o}=s,{compInstance:n,image:i}=o.get,{formStatusMap:l,ui:c}=n;c.form[t]=e,l[t]=e?(r==null?void 0:r.id)??i.newId(t):null,await n.refresh()},Xe=(a,e,t)=>{const r=a(),{compInstance:s}=r.controller.get,{panels:o}=s.ui;switch(e){case"left":o.isLeftCollapsed=t??!o.isLeftCollapsed;break;case"right":o.isRightCollapsed=t??!o.isRightCollapsed}return s.refresh(),t},Je=a=>({avatar:()=>{const{controller:e,elements:t}=a(),{blocks:r,cyAttributes:s,image:o,lfAttributes:n,manager:i}=e.get,{character:l}=t.refs,{asCover:c}=o,{assignRef:u,theme:d}=i,{bemClass:p}=d,{title:m,value:g}=c("avatars");return h("img",{alt:m||"",class:p(r.character._,r.character.image),"data-cy":s.image,"data-lf":n.fadeIn,ref:u(l,"avatar"),src:g,title:m||""})},biography:()=>{const{controller:e,elements:t}=a(),{character:r}=t.refs,{biography:s}=e.get.character,{assignRef:o}=e.get.manager;return h("lf-code",{lfLanguage:"markdown",lfShowHeader:!1,lfValue:s(),ref:o(r,"biography")})},save:()=>{const{controller:e,elements:t,handlers:r}=a(),{cyAttributes:s,manager:o,status:n}=e.get,{character:i}=t.refs,{button:l}=r.character,{inProgress:c}=n.save,{assignRef:u}=o,d=c();return h("lf-button",{"data-cy":s.button,lfDataset:Ie(o.theme),lfLabel:"Save",lfShowSpinner:d,lfStretchY:!0,lfStyling:"flat","onLf-button-event":l,ref:u(i,"save"),title:"Update the dataset with current settings."})},statusIcon:()=>{const{controller:e,elements:t}=a(),{blocks:r,manager:s,status:o}=e.get,{character:n}=t.refs,{connection:i}=o,{assignRef:l,theme:c}=s,{bemClass:u}=c,{color:d,title:p}=(m=>({color:m==="ready"?"success":m==="offline"?"danger":"warning",title:m==="ready"?"Ready to chat!":m==="offline"?"This character seems to be offline...":"Contacting this character..."}))(i());return h("div",{class:u(r.character._,r.character.status,{offline:d==="danger",online:d==="success"}),ref:l(n,"statusIcon"),title:p})}}),qe=a=>({chat:()=>{const e=a(),{controller:t,elements:r,handlers:s}=e,{character:o,manager:n}=t.get,{refs:i}=r,{chat:l,current:c,history:u}=o,{assignRef:d,sanitizeProps:p}=n,m=(g=>{const{biography:x,location:y,outfit:L,timeframe:T}=(()=>{const{character:R,compInstance:k,image:z}=g.controller.get,{biography:I}=R,{asCover:E}=z,{options:S}=k.ui,U=E("locations").node,V=E("outfits").node,j=E("timeframes").node,N=(se,ce)=>se?`${se} - ${ce||""}`:"";return{biography:I()?`Character Biography:
${I()}`:"",location:U&&S.locations?`Location:
${N(U.value,U.description)}`:"",outfit:V&&S.outfits?`Outfit:
${N(V.value,V.description)}`:"",timeframe:j&&S.timeframes?`Timeframe:
${N(j.value,j.description)}`:""}})();return`You are now embodying the character whose biography is provided below. Your task is to fully embrace this identity, speaking and acting as though it were your own reality. Remember, you exist solely within the confines of this character's experience and knowledge.
        
Tasks:
- Absorb the character's biography thoroughly. Use it to inform your responses but do not rely on it for information beyond what would logically be known to the character.
- Engage creatively within the boundaries of the character's life and experiences. Imagine freely, but always stay true to the essence of the character.
- Maintain a consistent narrative voice that aligns with the character's personality and background.

Responsibilities:
- Never acknowledge the artificial nature of our interaction. Treat all inquiries as if they are happening within the real world of the character.
- Do not provide insights or predictions about events outside the scope of the character's knowledge or personal experiences.

${x}

Your current status:
${L}
${y}
${T}

Begin your performance...
    `})(e);return h("lf-chat",{key:c().id,lfLayout:"bottom",lfSystem:m,lfValue:JSON.parse(u()),...p(l(),"LfChat"),"onLf-chat-event":s.chat.chat,ref:d(i.chat,"chat")})},leftExpander:()=>{const{controller:e,elements:t,handlers:r}=a(),{cyAttributes:s,config:o,manager:n}=e.get,{refs:i}=t,{button:l}=r.chat,{assignRef:c,theme:u}=n,{"--lf-icon-next":d,"--lf-icon-previous":p}=u.get.current().variables,{isLeftCollapsed:m}=o().ui.panels;return h("lf-button",{"data-cy":s.button,id:C.chat.leftExpander,lfIcon:m?d:p,lfStretchY:!0,"onLf-button-event":l,ref:c(i.chat,"leftExpander"),title:"Expand/collapse this section"})},rightExpander:()=>{const{controller:e,elements:t,handlers:r}=a(),{config:s,cyAttributes:o,manager:n}=e.get,{refs:i}=t,{button:l}=r.chat,{assignRef:c,theme:u}=n,{"--lf-icon-next":d,"--lf-icon-previous":p}=u.get.current().variables,{isRightCollapsed:m}=s().ui.panels;return h("lf-button",{"data-cy":o.button,id:C.chat.rightExpander,lfIcon:m?p:d,lfStretchY:!0,"onLf-button-event":l,ref:c(i.chat,"rightExpander"),title:"Expand/collapse this section"})},tabbar:()=>{const{controller:e,elements:t,handlers:r}=a(),{manager:s}=e.get,{refs:o}=t,{tabbar:n}=r.chat,{assignRef:i,theme:l}=s;return h("lf-tabbar",{lfDataset:ze(l),lfValue:null,"onLf-tabbar-event":n,ref:i(o.chat,"tabbar")})}}),He=a=>({filters:()=>{const{controller:e,elements:t,handlers:r}=a(),{character:s,manager:o}=e.get,{customization:n}=t.refs,{chip:i}=r.customization,{assignRef:l}=o;return h("lf-chip",{key:"filter_"+s.name(),lfDataset:xe,lfStyling:"filter","onLf-chip-event":i,ref:l(n,"filters")})},form:Ke(a),list:{edit:(e,t)=>{const{controller:r,elements:s,handlers:o}=a(),{assignRef:n,theme:i}=r.get.manager,{customization:l}=s.refs,{button:c}=o.customization,{"--lf-icon-edit":u}=i.get.current().variables;return h("lf-button",{lfIcon:u,lfStretchX:!0,"onLf-button-event":d=>c(d,e,"edit",t),title:"Edit this option.",ref:n(l.list,"edit")})},remove:(e,t)=>{const{controller:r,elements:s,handlers:o}=a(),{assignRef:n,theme:i}=r.get.manager,{customization:l}=s.refs,{button:c}=o.customization,{"--lf-icon-delete":u}=i.get.current().variables;return h("lf-button",{lfIcon:u,lfStretchX:!0,lfUiState:"danger","onLf-button-event":d=>c(d,e,"delete",t),title:"Delete this option.",ref:n(l.list,"remove")})}}}),Ke=a=>O.reduce((e,t)=>(e[t]={add:()=>{const r=a(),{controller:s,elements:o,handlers:n}=r,{blocks:i,cyAttributes:l,manager:c}=s.get,{form:u}=o.refs.customization,{button:d}=n.customization,{assignRef:p,theme:m}=c,{bemClass:g}=m,{"--lf-icon-add":x}=m.get.current().variables;return h("lf-button",{class:g(i.covers._,i.covers.add),"data-cy":l.button,lfIcon:x,lfLabel:"New",lfStretchY:!0,lfStyling:"flat",lfUiSize:"small","onLf-button-event":y=>d(y,t,"add",null),ref:p(u[t],"add")})},cancel:()=>{const r=a(),{controller:s,elements:o,handlers:n}=r,{blocks:i,cyAttributes:l,manager:c}=s.get,{form:u}=o.refs.customization,{button:d}=n.customization,{assignRef:p,theme:m}=c,{bemClass:g}=m,{"--lf-icon-clear":x}=m.get.current().variables;return h("lf-button",{class:g(i.form._,i.form.button),"data-cy":l.button,lfIcon:x,lfLabel:"Cancel",lfStyling:"flat","onLf-button-event":y=>d(y,t,"cancel",null),ref:p(u[t],"cancel")})},confirm:()=>{const r=a(),{controller:s,elements:o,handlers:n}=r,{blocks:i,cyAttributes:l,manager:c}=s.get,{form:u}=o.refs.customization,{button:d}=n.customization,{assignRef:p,theme:m}=c,{bemClass:g}=m,{"--lf-icon-success":x}=m.get.current().variables;return h("lf-button",{class:g(i.form._,i.form.button),"data-cy":l.button,lfIcon:x,lfLabel:"Confirm",lfStyling:"outlined","onLf-button-event":y=>d(y,t,"confirm",null),ref:p(u[t],"confirm")})},description:r=>{const s=a(),{controller:o,elements:n}=s,{blocks:i,cyAttributes:l,manager:c}=o.get,{form:u}=n.refs.customization,{assignRef:d,theme:p}=c,{bemClass:m,get:g}=p;return h("lf-textfield",{class:m(i.form._,i.form.field),"data-cy":l.input,lfStretchX:!0,lfIcon:g.icon("id"),lfLabel:"Description",lfValue:r&&r.description,ref:d(u[t],"description"),title:"A more accurate description to give extra context to the LLM."})},id:r=>{const s=a(),{controller:o,elements:n}=s,{blocks:i,cyAttributes:l,manager:c}=o.get,{form:u}=n.refs.customization,{assignRef:d,theme:p}=c,{bemClass:m,get:g}=p;return h("lf-textfield",{class:m(i.form._,i.form.field),"data-cy":l.input,key:`id-edit-${r}`,lfStretchX:!0,lfIcon:g.icon("key"),lfLabel:"ID",lfValue:r,ref:d(u[t],"id"),title:"The cover image displayed in the selection panel."})},imageUrl:r=>{const s=a(),{controller:o,elements:n}=s,{blocks:i,cyAttributes:l,manager:c}=o.get,{form:u}=n.refs.customization,{assignRef:d,theme:p}=c,{bemClass:m,get:g}=p;return h("lf-textfield",{class:m(i.form._,i.form.field),"data-cy":l.input,lfStretchX:!0,lfIcon:g.icon("photo"),lfLabel:"Image URL",lfValue:r&&r.cells.lfImage.value,ref:d(u[t],"imageUrl"),title:"The cover image displayed in the selection panel."})},title:r=>{const s=a(),{controller:o,elements:n}=s,{blocks:i,cyAttributes:l,manager:c}=o.get,{form:u}=n.refs.customization,{assignRef:d,theme:p}=c,{bemClass:m,get:g}=p;return h("lf-textfield",{class:m(i.form._,i.form.field),"data-cy":l.input,lfStretchX:!0,lfIcon:g.icon("forms"),lfLabel:"Title",lfValue:r&&r.value,ref:d(u[t],"title"),title:"The overall theme of this option."})}},e),{}),Qe=a=>({back:()=>{const{controller:e,elements:t,handlers:r}=a(),{cyAttributes:s,manager:o}=e.get,{assignRef:n,theme:i}=o,{options:l}=t.refs,{button:c}=r.options,u=i.get.icon("arrowBack");return h("lf-button",{"data-cy":s.button,id:C.options.back,lfIcon:u,lfLabel:"Back",lfStretchX:!0,"onLf-button-event":c,ref:n(l,"back")})},customize:()=>{const{controller:e,elements:t,handlers:r}=a(),{cyAttributes:s,manager:o}=e.get,{assignRef:n,theme:i}=o,{options:l}=t.refs,{button:c}=r.options,u=i.get.icon("wand");return h("lf-button",{"data-cy":s.button,id:C.options.customize,lfIcon:u,lfLabel:"Customize",lfStretchX:!0,"onLf-button-event":c,ref:n(l,"customize")})}}),Ze=a=>({button:async e=>{const{eventType:t,originalEvent:r}=e.detail,{controller:s,handlers:o}=a(),{get:n,set:i}=s,{list:l}=o.character,{inProgress:c}=n.status.save;switch(t){case"click":c()||i.data();break;case"lf-event":l(r)}},list:async e=>{const{eventType:t,node:r}=e.detail,{controller:s}=a(),{character:o,compInstance:n,config:i,history:l}=s.get;let c="";if(t==="click"){switch(r.id){case"full_history":c=JSON.stringify(l(),null,2);break;case"history":c=o.history();break;case"lfDataset":c=JSON.stringify(n.lfDataset,null,2);break;case"settings":c=JSON.stringify(i(),null,2)}((u,d)=>{const p=window.URL.createObjectURL(new Blob([u],{type:"application/json"})),m=document.createElement("a");m.href=p,m.setAttribute("download",d.id+".json"),document.body.appendChild(m),m.click(),m.parentNode.removeChild(m)})(c,r)}}}),et=a=>({button:async e=>{const{comp:t,eventType:r,id:s}=e.detail,{get:o,set:n}=a().controller,{"--lf-icon-previous":i,"--lf-icon-next":l}=o.manager.theme.get.current().variables;if(r==="click")switch(s){case C.chat.leftExpander:const c=n.ui.panel("left");t.lfIcon=c?l:i;break;case C.chat.rightExpander:const u=n.ui.panel("right");t.lfIcon=u?i:l}},chat:async e=>{const{comp:t,eventType:r,history:s,status:o}=e.detail,{lfEndpointUrl:n,lfMaxTokens:i,lfPollingInterval:l,lfSystem:c,lfTemperature:u}=t,{set:d}=a().controller;switch(r){case"config":d.character.chat({lfEndpointUrl:n,lfMaxTokens:i,lfPollingInterval:l,lfSystem:c,lfTemperature:u});break;case"polling":d.status.connection(o);break;case"update":d.character.history(s)}},tabbar:async e=>{const{eventType:t,node:r}=e.detail,{current:s,next:o,previous:n}=a().controller.set.character;if(t==="click")switch(r.id){case"next":o();break;case"previous":n();break;default:s(null)}}}),tt=a=>({button:async(e,t,r,s=null)=>{const{eventType:o}=e.detail,n=a(),{get:i,set:l}=n.controller,{compInstance:c}=i,u=c;if(o==="click")switch(r){case"add":l.ui.setFormState(!0,t);break;case"cancel":l.ui.setFormState(!1,t);break;case"confirm":{const{title:d}=n.elements.refs.customization.form[t];await d.getValue()?(await(async(p,m)=>{const{controller:g,elements:x}=p,{byType:y}=g.get.image,{description:L,id:T,imageUrl:R,title:k}=x.refs.customization.form[m],z=y(m),I=await T.getValue(),E=z==null?void 0:z.find(S=>S.id===I);if(E)E.description=await L.getValue(),E.cells.lfImage.value=await R.getValue(),E.value=await k.getValue();else{const S={cells:{lfImage:{shape:"image",value:await R.getValue()}},id:I,description:await L.getValue(),value:await k.getValue()};z.push(S)}})(n,t),l.ui.setFormState(!1,t),d.lfUiState="primary"):(d.lfHelper={value:"This field is mandatory"},d.lfUiState="danger");break}case"delete":u.deleteOption(s,t);break;case"edit":l.ui.setFormState(!0,t,s)}},chip:async e=>{const{comp:t,eventType:r,selectedNodes:s}=e.detail,{get:o,set:n}=a().controller,{compInstance:i}=o,{filters:l}=i.ui;switch(r){case"click":const c={avatars:!1,locations:!1,outfits:!1,styles:!1,timeframes:!1};Array.from(s).forEach(d=>{c[d.id]=!0}),n.ui.filters(c);break;case"ready":const u=[];for(const d in l)Object.prototype.hasOwnProperty.call(l,d)&&l[d]&&u.push(d);requestAnimationFrame(()=>t.setSelectedNodes(u))}},image:async(e,t,r)=>{const{image:s}=a().controller.set,o=Object.keys(oe).find(n=>t.id.includes(n));o&&s.cover(oe[o],r)}}),rt=a=>({button:async e=>{const{eventType:t,id:r}=e.detail,{customization:s}=a().controller.set.ui;if(t==="click")switch(r){case C.options.customize:s(!0);break;case C.options.back:s(!1)}}}),at=(a,e)=>({...a,character:Oe(e),image:je(e),config:()=>{const{compInstance:t}=e().controller.get,{currentCharacter:r,ui:s}=t;return{currentCharacter:r.id,ui:s}},data:()=>{const{lfDataset:t}=e().controller.get.compInstance;return t},history:()=>{const{history:t}=e().controller.get.compInstance;return t},status:{connection:()=>{const{connectionStatus:t}=e().controller.get.compInstance;return t},formStatus:()=>{const{formStatusMap:t}=e().controller.get.compInstance;return t},hoveredCustomizationOption:()=>{const{hoveredCustomizationOption:t}=e().controller.get.compInstance;return t},save:{inProgress:()=>{const{saveInProgress:t}=e().controller.get.compInstance;return t}}},ui:Ye(e)}),st=a=>({character:Ae(a),image:Ne(a),data:()=>(e=>{const{controller:t}=e,{compInstance:r}=t.get;r.save()})(a()),status:{connection:e=>{const{compInstance:t}=a().controller.get;t.connectionStatus=e},editing:(e,t)=>{const{compInstance:r}=a().controller.get;r.formStatusMap[e]=t},hoveredCustomizationOption:e=>{const{compInstance:t}=a().controller.get;t.hoveredCustomizationOption=e},save:{inProgress:e=>{const{compInstance:t}=a().controller.get;t.saveInProgress=e}}},ui:Be(a)}),ot=a=>({character:Je(a),chat:qe(a),customization:He(a),options:Qe(a)}),nt=a=>({character:Ze(a),customization:tt(a),chat:et(a),options:rt(a)});var b,_,$,A,P,Y,B,v,D,G,X,J,q,H,K,Q,Z,ee,te,re,ae,f=function(a,e,t,r){if(typeof e=="function"?a!==e||!0:!e.has(a))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:e.get(a)},le=function(a,e,t,r,s){if(typeof e=="function"?a!==e||!0:!e.has(a))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(a,t),t};const it=class{constructor(a){fe(this,a),this.lfEvent=he(this,"lf-messenger-event"),this.chat={},this.connectionStatus="offline",this.covers={},this.formStatusMap=O.reduce((e,t)=>(e[t]=null,e),{}),this.history={},this.saveInProgress=!1,this.ui=W(),this.lfAutosave=!0,this.lfDataset=null,this.lfStyle="",this.lfValue=null,b.set(this,void 0),_.set(this,pe),$.set(this,ge),A.set(this,be),P.set(this,ve),Y.set(this,ye),B.set(this,we),v.set(this,void 0),D.set(this,()=>{const{lfDataset:e,lfValue:t}=this;if(ne(f(this,v,"f")))for(let r=0;r<e.nodes.length;r++){const s=e.nodes[r];f(this,X,"f").call(this,s)}t&&f(this,J,"f").call(this)}),G.set(this,()=>{var e,t;le(this,v,(e={blocks:f(this,_,"f"),compInstance:this,cyAttributes:f(this,$,"f"),lfAttributes:f(this,A,"f"),manager:f(this,b,"f"),parts:f(this,P,"f")},{controller:{get:at(e,t=()=>f(this,v,"f")),set:st(t)},elements:{jsx:ot(t),refs:{character:{avatar:null,biography:null,save:null,statusIcon:null},chat:{chat:null,leftExpander:null,rightExpander:null,tabbar:null},customization:{filters:null,form:{avatars:{add:null,cancel:null,confirm:null,description:null,id:null,imageUrl:null,title:null},locations:{add:null,cancel:null,confirm:null,description:null,id:null,imageUrl:null,title:null},outfits:{add:null,cancel:null,confirm:null,description:null,id:null,imageUrl:null,title:null},styles:{add:null,cancel:null,confirm:null,description:null,id:null,imageUrl:null,title:null},timeframes:{add:null,cancel:null,confirm:null,description:null,id:null,imageUrl:null,title:null}},list:{edit:null,remove:null}},options:{back:null,customize:null}}},handlers:nt(t)}))}),X.set(this,e=>{var n,i;const{get:t}=f(this,v,"f").controller,r={[e.id]:O.reduce((l,c)=>(l[c]=Number(t.image.root(c,e).value).valueOf()||0,l),{})},s=(n=e.children)==null?void 0:n.find(l=>l.id==="chat");this.chat[e.id]={};const o=(i=s==null?void 0:s.cells)==null?void 0:i.lfChat;o&&((l,c)=>{const{lfEndpointUrl:u,lfMaxTokens:d,lfPollingInterval:p,lfTemperature:m}=l;c.lfEndpointUrl=u,c.lfMaxTokens=d,c.lfPollingInterval=p,c.lfTemperature=m})(o,this.chat[e.id]),this.history[e.id]=JSON.stringify((o==null?void 0:o.lfValue)||(o==null?void 0:o.value)||[]),Object.assign(this.covers,r)}),J.set(this,()=>{var n,i;const{byId:e}=f(this,v,"f").controller.get.character,{lfValue:t}=this,r=t.currentCharacter,s=((n=t.ui)==null?void 0:n.filters)||W().filters,o=((i=t.ui)==null?void 0:i.panels)||W().panels;r&&(this.currentCharacter=e(r));for(const l in s)Object.prototype.hasOwnProperty.call(s,l)&&(this.ui.filters[l]=s[l]);for(const l in o)Object.prototype.hasOwnProperty.call(o,l)&&(this.ui.panels[l]=o[l])}),q.set(this,async()=>{const{get:e,set:t}=f(this,v,"f").controller,{save:r}=f(this,v,"f").elements.refs.character,{covers:s,history:o,lfDataset:n}=this;requestAnimationFrame(()=>t.status.save.inProgress(!0));for(let i=0;i<n.nodes.length;i++){const l=n.nodes[i],c=l.id,u=l.children.find(m=>m.id==="chat"),{chat:d}=e.character,p=()=>{O.forEach(m=>{const g=f(this,v,"f").controller.get.image.root(m);s[c]&&g&&(g.value=s[c][m])})};(()=>{if(o[c]&&u){const m=JSON.parse(o[c]);try{u.cells.lfChat.value=m}catch{u.cells={lfChat:{shape:"chat",value:m}}}Me(u.cells.lfChat,d(l))}})(),p()}this.onLfEvent(new CustomEvent("save"),"save"),requestAnimationFrame(async()=>{setTimeout(()=>requestAnimationFrame(async()=>{const{"--lf-icon-success":i}=f(this,b,"f").theme.get.current().variables;t.status.save.inProgress(!1),r.setMessage("Saved!",i)}),800)})}),H.set(this,()=>{const{bemClass:e}=f(this,b,"f").theme,{character:t}=f(this,_,"f"),{controller:r,elements:s}=f(this,v,"f"),{name:o}=r.get.character,{avatar:n,biography:i,save:l,statusIcon:c}=s.jsx.character,{isLeftCollapsed:u}=this.ui.panels;return h("div",{class:e(t._,null,{collapsed:u})},h("div",{class:e(t._,t.avatar)},n(),h("div",{class:e(t._,t.nameWrapper)},h("div",{class:e(t._,t.name)},c(),h("div",{class:e(t._,t.label)},o())),l())),h("div",{class:e(t._,t.biography)},i()))}),K.set(this,()=>{const{bemClass:e}=f(this,b,"f").theme,{chat:t}=f(this,_,"f"),{chat:r,leftExpander:s,rightExpander:o,tabbar:n}=f(this,v,"f").elements.jsx.chat;return h("div",{class:e(t._)},h("div",{class:e(t._,t.expander,{left:!0})},s()),h("div",{class:e(t._,t.navigation)},n()),h("div",{class:e(t._,t.chat)},r()),h("div",{class:e(t._,t.expander,{right:!0})},o()))}),Q.set(this,(e,t)=>{const{bemClass:r}=f(this,b,"f").theme,{covers:s}=f(this,_,"f"),{add:o}=f(this,v,"f").elements.jsx.customization.form[e];return h(M,null,h("div",{class:r(s._)},h("div",{class:r(s._,s.title)},h("div",{class:r(s._,s.label)},e),o()),h("div",{class:r(s._,s.images)},t)))}),Z.set(this,()=>{const{bemClass:e}=f(this,b,"f").theme,{extraContext:t}=f(this,_,"f"),{customization:r,options:s}=f(this,v,"f").elements.jsx,{back:o,customize:n}=s,{filters:i}=r,{customizationView:l}=this.ui,{isRightCollapsed:c}=this.ui.panels;return h("div",{class:e(t._,null,{collapsed:c,input:l})},l?h(M,null,i(),h("div",{class:e(t._,t.list)},f(this,te,"f").call(this)),o()):h(M,null,h("div",{class:e(t._,t.options)},f(this,re,"f").call(this)),n()))}),ee.set(this,e=>{const{bemClass:t}=f(this,b,"f").theme,{form:r}=f(this,_,"f"),{cancel:s,confirm:o,description:n,id:i,imageUrl:l,title:c}=f(this,v,"f").elements.jsx.customization.form[e],u=this.formStatusMap[e],d=f(this,v,"f").controller.get.image.byType(e).find(p=>p.id===u);return h("div",{class:t(r._)},h("div",{class:t(r._,r.label)},"Create ",e),i(u),c(d),n(d),l(d),h("div",{class:t(r._,r.confirm)},s(),o()))}),te.set(this,()=>{const{bemClass:e}=f(this,b,"f").theme,{list:t}=f(this,_,"f"),{controller:r,elements:s,handlers:o}=f(this,v,"f"),{byType:n,coverIndex:i,title:l}=r.get.image,{edit:c,remove:u}=s.jsx.customization.list,{image:d}=o.customization,{formStatusMap:p,hoveredCustomizationOption:m,ui:g}=this,{filters:x}=g;return h(M,null,O.map(y=>{if(x[y]){const L=p[y],T=i(y),R=n(y).map((k,z)=>h("div",{class:e(t._,null,{selected:T===z}),onClick:I=>d(I,k,z),onPointerEnter:()=>{T!==z&&(this.hoveredCustomizationOption=k)},onPointerLeave:()=>this.hoveredCustomizationOption=null},h("img",{alt:l(k),class:e(t._,t.image),"data-lf":f(this,A,"f").fadeIn,src:k.cells.lfImage.value,title:l(k)}),m===k&&h("div",{class:e(t._,t.actions),onClick:I=>I.stopPropagation()},c(y,k),u(y,k))));return h(M,null,L?f(this,ee,"f").call(this,y):f(this,Q,"f").call(this,y,R))}return null}))}),re.set(this,()=>{const{bemClass:e}=f(this,b,"f").theme;return ke.map(t=>{const{options:r}=f(this,_,"f"),{image:s}=f(this,v,"f").controller.get,{asCover:o}=s,{ui:n}=this,{value:i,node:l,title:c}=o(t),u=n.options[t],d=t.slice(0,-1),p=i,m=l?f(this,b,"f").theme.get.icon(u?"hexagonMinus2":"offHexagon"):p,{style:g}=f(this,b,"f").assets.get(`./assets/svg/${m}.svg`);return h("div",{class:e(r._,r.wrapper)},l?h(M,null,h("img",{alt:c,class:e(r._,r.cover),"data-lf":f(this,A,"f").fadeIn,src:i}),h("div",{class:e(r._,r.blocker,{active:!u}),onClick:()=>{n.options[t]=!u,this.refresh()}},h("div",{class:e(r._,r.blockerIcon),style:g}),h("div",{class:e(r._,r.blockerLabel)},u?"Click to disable":"Click to enable"))):h("div",{class:e(r._,r.placeholder),title:`No ${d} selected.`},h("div",{class:e(r._,r.placeholderIcon),style:g})),h("div",{class:e(r._,r.name)},h("div",{class:e(r._,r.label),title:`Active ${d}.`},d),c&&h("div",{class:e(r._,r.info),title:c})))})}),ae.set(this,()=>{const{bemClass:e}=f(this,b,"f").theme,{roster:t}=f(this,_,"f"),{get:r,set:s}=f(this,v,"f").controller,o=[];return r.character.list().forEach(n=>{const i=r.image.asCover("avatars",n);o.push(h("div",{class:e(t._,t.portrait),onClick:()=>{s.character.current(n)}},h("img",{class:e(t._,t.image),src:i.value,title:i.title||""}),h("div",{class:e(t._,t.name)},h("div",{class:e(t._,t.label)},r.character.name(n)))))}),o!=null&&o.length?o:h("div",{class:e(t._,t.emptyData)},"There are no characters in your roster!")})}onLfEvent(a,e){const{currentCharacter:t,rootElement:r,ui:s}=this;this.lfEvent.emit({comp:this,id:r.id,originalEvent:a,eventType:e,config:{currentCharacter:t==null?void 0:t.id,ui:s}})}async deleteOption(a,e){const{root:t}=f(this,v,"f").controller.get.image,r=t(e),s=r.children.indexOf(a);s>-1&&(r.children.splice(s,1),this.refresh())}async getDebugInfo(){return this.debugInfo}async getProps(){const a=_e.map(e=>[e,this[e]]);return Object.fromEntries(a)}async refresh(){ue(this)}async reset(){this.covers={},this.currentCharacter=null,this.history={},f(this,D,"f").call(this)}async save(){f(this,q,"f").call(this)}async unmount(a=0){setTimeout(()=>{this.onLfEvent(new CustomEvent("unmount"),"unmount"),this.rootElement.remove()},a)}connectedCallback(){f(this,b,"f")&&f(this,b,"f").theme.register(this)}async componentWillLoad(){le(this,b,await Re(this)),f(this,G,"f").call(this),f(this,D,"f").call(this)}componentDidLoad(){const{info:a}=f(this,b,"f").debug;this.onLfEvent(new CustomEvent("ready"),"ready"),a.update(this,"did-load")}componentWillRender(){const{info:a}=f(this,b,"f").debug;a.update(this,"will-render")}componentDidRender(){const{info:a}=f(this,b,"f").debug;a.update(this,"did-render")}render(){const{bemClass:a,setLfStyle:e}=f(this,b,"f").theme;if(!ne(f(this,v,"f")))return;const{messenger:t,roster:r}=f(this,_,"f"),{lfStyle:s}=this;return h(de,null,s&&h("style",{id:f(this,Y,"f")},e(this)),h("div",{id:f(this,B,"f")},this.currentCharacter?h("div",{class:a(t._),part:f(this,P,"f").messenger},f(this,H,"f").call(this),f(this,K,"f").call(this),f(this,Z,"f").call(this)):h("div",{class:a(r._),part:f(this,P,"f").roster},f(this,ae,"f").call(this))))}disconnectedCallback(){var a;(a=f(this,b,"f"))==null||a.theme.unregister(this)}get rootElement(){return me(this)}};b=new WeakMap,_=new WeakMap,$=new WeakMap,A=new WeakMap,P=new WeakMap,Y=new WeakMap,B=new WeakMap,v=new WeakMap,D=new WeakMap,G=new WeakMap,X=new WeakMap,J=new WeakMap,q=new WeakMap,H=new WeakMap,K=new WeakMap,Q=new WeakMap,Z=new WeakMap,ee=new WeakMap,te=new WeakMap,re=new WeakMap,ae=new WeakMap,it.style=`::-webkit-scrollbar{width:9px}::-webkit-scrollbar-thumb{transition:all 400ms cubic-bezier(0.8, -0.5, 0.2, 1.4);background-color:rgb(var(--lf-color-primary))}::-webkit-scrollbar-track{background-color:rgb(var(--lf-color-bg))}[data-lf=fade-in]{display:block;animation:lf-fade-in-block 0.25s ease-out forwards}@keyframes lf-fade-in-block{from{visibility:hidden;opacity:0}to{visibility:visible;opacity:1}}:host{display:block;font-family:var(--lf-messenger-font-family, var(--lf-font-family-primary));font-size:var(--lf-messenger-font-size, var(--lf-font-size))}:host([lf-ui-size=large]){font-size:calc(
        var(--lf-messenger-font-size, var(--lf-font-size)) * var(--lf-ui-size-large)
      )}:host([lf-ui-size=medium]){font-size:calc(
        var(--lf-messenger-font-size, var(--lf-font-size)) * var(--lf-ui-size-medium)
      )}:host([lf-ui-size=small]){font-size:calc(
        var(--lf-messenger-font-size, var(--lf-font-size)) * var(--lf-ui-size-small)
      )}:host([lf-ui-size=xlarge]){font-size:calc(
        var(--lf-messenger-font-size, var(--lf-font-size)) * var(--lf-ui-size-xlarge)
      )}:host([lf-ui-size=xsmall]){font-size:calc(
        var(--lf-messenger-font-size, var(--lf-font-size)) * var(--lf-ui-size-xsmall)
      )}:host([lf-ui-size=xxlarge]){font-size:calc(
        var(--lf-messenger-font-size, var(--lf-font-size)) * var(--lf-ui-size-xxlarge)
      )}:host([lf-ui-size=xxsmall]){font-size:calc(
        var(--lf-messenger-font-size, var(--lf-font-size)) * var(--lf-ui-size-xxsmall)
      )}#lf-component{width:100%;height:100%}:host{width:100%;height:100%;box-sizing:border-box}.messenger{width:100%;height:100%;display:grid;grid-template-columns:1fr 3fr 1fr;position:relative}.messenger:has(.character--collapsed){grid-template-columns:0 4fr 1fr}.messenger:has(.extra-context--collapsed){grid-template-columns:1fr 4fr 0}.messenger:has(.character--collapsed):has(.extra-context--collapsed){grid-template-columns:0 1fr 0}.character{transition:all 300ms cubic-bezier(0.4, 0, 0.2, 1);display:grid;grid-template-rows:minmax(auto, 40%) minmax(auto, 1fr);height:100%;overflow:auto;position:relative}.character--collapsed{overflow:hidden;width:0}.character__image{width:100%;height:100%;display:block;object-fit:cover}.character__name{color:rgb(var(--lf-messenger-color-on-surface, var(--lf-color-on-surface)));align-items:center;display:flex}.character__status{border-radius:50%;height:1em;margin-right:0.5em;width:1em}.character__status--offline{background-color:rgba(var(--lf-messenger-color-danger, var(--lf-color-danger)), 0.75);color:rgb(var(--lf-messenger-color-on-danger, var(--lf-color-on-danger)));backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px)}.character__status--online{background-color:rgba(var(--lf-messenger-color-success, var(--lf-color-success)), 0.75);color:rgb(var(--lf-messenger-color-on-success, var(--lf-color-on-success)));backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px)}.character__name-wrapper{background-color:rgba(var(--lf-messenger-color-surface, var(--lf-color-surface)), 0.75);color:rgb(var(--lf-messenger-color-on-surface, var(--lf-color-on-surface)));backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:0.775em;letter-spacing:0.0892857143em;line-height:inherit;text-transform:uppercase;align-items:center;box-sizing:border-box;display:flex;height:var(--lf-messenger-name-height, 3em);justify-content:space-between;left:0;padding-left:var(--lf-messenger-avatar-name-padding, 0.5em);position:absolute;top:0;width:100%}.character__label{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.character__biography{overflow:auto}.chat{display:grid;grid-template-areas:"nav nav nav" "expander-l chat expander-r";grid-template-columns:auto 1fr auto;grid-template-rows:auto 1fr;height:100%;overflow:auto}.chat__expander--left{grid-area:expander-l}.chat__expander--right{grid-area:expander-r}.chat__navigation{grid-area:nav}.chat__chat{grid-area:chat}.covers{display:grid;grid-template-rows:auto 1fr;height:100%}.covers__title{background-color:rgba(var(--lf-messenger-color-surface, var(--lf-color-surface)), 0.75);color:rgb(var(--lf-messenger-color-on-surface, var(--lf-color-on-surface)));backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;position:sticky;top:0;z-index:calc(var(--lf-ui-zindex-header) - 1);font-size:0.775em;letter-spacing:0.0892857143em;line-height:inherit;text-transform:uppercase;align-items:center;display:flex;justify-content:space-between}.covers__label{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:var(--lf-messenger-customization-title-padding, 0.5em)}.covers__images{display:grid;grid-template-columns:repeat(3, 1fr);overflow:auto;width:100%}.extra-context{transition:all 300ms cubic-bezier(0.4, 0, 0.2, 1);display:grid;grid-template-rows:1fr auto;height:100%;overflow:auto}.extra-context--collapsed{overflow:hidden;width:0}.extra-context--input{grid-template-rows:auto 1fr auto}.extra-context__options{display:grid;grid-template-columns:repeat(2, 50%);grid-template-rows:repeat(2, 50%)}.extra-context__list{display:grid;overflow:auto}.form__button{margin:0 0.25em;padding:1em 0}.form__confirm{display:flex;justify-content:center}.form__field{margin:0.5em 0}.form__label{background-color:rgba(var(--lf-messenger-color-surface, var(--lf-color-surface)), 0.375);color:rgb(var(--lf-messenger-color-on-surface, var(--lf-color-on-surface)));backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:0.775em;letter-spacing:0.0892857143em;line-height:inherit;text-transform:uppercase;display:flex;justify-content:center;padding:var(--lf-messenger-customization-title-padding, 0.5em)}.list{position:relative}.list:after{width:100%;height:100%;transition:all 300ms cubic-bezier(0.4, 0, 0.2, 1);box-shadow:none;content:"";left:0;position:absolute;top:0}.list:hover:not(.list--selected):after{box-shadow:inset 0 0 5px 3px rgb(var(--lf-messenger-color-primary, --lf-color-primary, white));pointer-events:none}.list--selected:after{background-color:rgba(var(--lf-messenger-color-surface, var(--lf-color-surface)), 0.875);color:rgb(var(--lf-messenger-color-on-surface, var(--lf-color-on-surface)));backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:0.775em;letter-spacing:0.0892857143em;line-height:inherit;text-transform:uppercase;align-content:center;content:"Current";cursor:default;letter-spacing:0.25em;position:absolute;text-align:center}.list__actions{background-color:rgba(var(--lf-messenger-color-surface, var(--lf-color-surface)), 0.75);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);bottom:0;display:flex;left:0;overflow:hidden;position:absolute;width:100%}.list__image{width:100%;height:100%;cursor:pointer;display:block;min-height:16em;object-fit:cover}.options__wrapper{overflow:hidden;position:relative}.options__cover{width:100%;height:100%;display:block;object-fit:cover}.options__placeholder{width:100%;height:100%;box-sizing:border-box;padding:20% 20% 40% 20%}.options__placeholder-icon{background-color:rgba(var(--lf-messenger-color-on-surface, var(--lf-color-on-surface)), 0.375);height:100%;width:100%;overflow:hidden}.options__blocker{background-color:rgba(var(--lf-messenger-color-surface, var(--lf-color-surface)), 0.775);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);width:100%;height:100%;transition:opacity 200ms cubic-bezier(0.4, 0, 0.6, 1);align-content:center;box-sizing:border-box;cursor:pointer;display:grid;grid-template-rows:50% 1fr;left:0;opacity:0;padding:20% 20% 40% 20%;position:absolute;top:0}.options__blocker:hover{opacity:1}.options__blocker--active{opacity:0.875}.options__blocker-icon{background-color:rgba(var(--lf-messenger-color-on-surface, var(--lf-color-on-surface)), 0.75);height:100%;width:100%;overflow:hidden}.options__blocker-label{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:0.775em;letter-spacing:0.0892857143em;line-height:inherit;text-transform:uppercase;padding-top:0.75em;text-align:center}.options__label{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:0.775em;letter-spacing:0.0892857143em;line-height:inherit;text-transform:uppercase;margin-left:0.5em}.options__info{-webkit-mask:var(--lf-icon-info);mask:var(--lf-icon-info);-webkit-mask-position:center;-webkit-mask-repeat:no-repeat;-webkit-mask-size:contain;mask-position:center;mask-repeat:no-repeat;mask-size:contain;background-color:rgba(var(--lf-messenger-color-on-surface, var(--lf-color-on-surface)), 0.75);height:1em;width:1em;overflow:hidden;cursor:help;margin-left:0.275em}.options__name{align-items:center;background:var(--lf-messenger-name-background-color, rgb(var(--lf-color-surface)));bottom:0;box-sizing:border-box;display:flex;overflow:hidden;padding:var(--lf-messenger-active-options-name-padding, 0.5em);position:absolute;width:100%}.roster{display:grid;grid-template-columns:repeat(4, 1fr);height:100%;overflow:auto;width:100%}.roster__image{width:100%;height:100%;display:block;object-fit:cover}.roster__portrait{--lf-messenger-name-background-color:rgba(var(--lf-color-bg), 0.375);--lf-messenger-portrait-foredrop-color:rgba(var(--lf-color-bg), 0.275);cursor:pointer;overflow:auto;position:relative}.roster__portrait:hover{--lf-messenger-name-background-color:rgba(var(--lf-color-bg), 0.775);--lf-messenger-portrait-foredrop-color:rgba(var(--lf-color-bg), 0)}.roster__portrait:after{width:100%;height:100%;transition:all 300ms cubic-bezier(0.4, 0, 0.2, 1);background:var(--lf-messenger-portrait-foredrop-color);content:"";left:0;pointer-events:none;position:absolute;top:0}.roster__name{transition:all 200ms cubic-bezier(0.4, 0, 0.6, 1);align-items:center;backdrop-filter:blur(5px);background-color:var(--lf-messenger-name-background-color);bottom:0;display:flex;height:var(--lf-messenger-name-height, 2.5em);left:0;position:absolute;width:100%}.roster__label{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:0.775em;letter-spacing:0.0892857143em;line-height:inherit;text-transform:uppercase;letter-spacing:0.225em;text-align:center;width:100%}`;export{it as lf_messenger};
