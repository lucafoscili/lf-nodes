import { IMAGE_EDITOR_CONSTANTS } from '../../../helpers/imageEditor/constants';
import {
  ImageEditorControls,
  ImageEditorFilters,
  ImageEditorInpaintIds,
  ImageEditorSelectIds,
  ImageEditorSliderIds,
  ImageEditorTextfieldIds,
  ImageEditorToggleIds,
} from '../../../types/widgets/imageEditor';

export const DIFFUSION_SETTINGS: Pick<ImageEditorFilters, 'inpaint' | 'outpaint'> = {
  //#region Inpaint
  [IMAGE_EDITOR_CONSTANTS.FILTERS.INPAINT]: {
    controlIds: ImageEditorInpaintIds,
    hasCanvasAction: true,
    settings: {
      apply_unsharp_mask: true,
      b64_canvas: '',
      cfg: 7,
      conditioning_mix: 0,
      denoise_percentage: 40,
      dilate: 0,
      feather: 0,
      negative_prompt: '',
      positive_prompt: '',
      roi_align: 8,
      roi_align_auto: false,
      roi_auto: true,
      roi_min_size: 64,
      roi_padding: 32,
      sampler: 'dpmpp_2m',
      scheduler: 'karras',
      seed: -1,
      steps: 16,
      upsample_target: 2048,
      wd14_tagging: false,
    },
    configs: {
      [ImageEditorControls.Multiinput]: [
        {
          ariaLabel: 'Positive prompt',
          controlType: ImageEditorControls.Multiinput,
          defaultValue: '',
          id: ImageEditorTextfieldIds.PositivePrompt,
          isMandatory: false,
          title: 'Prompt applied to masked pixels.',
          mode: 'tags',
          allowFreeInput: true,
        },
        {
          ariaLabel: 'Negative prompt',
          controlType: ImageEditorControls.Multiinput,
          defaultValue: '',
          id: ImageEditorTextfieldIds.NegativePrompt,
          isMandatory: false,
          title: 'Negative prompt applied to masked pixels.',
          mode: 'tags',
          allowFreeInput: true,
        },
      ],
      [ImageEditorControls.Select]: [
        {
          ariaLabel: 'Sampler',
          controlType: ImageEditorControls.Select,
          defaultValue: 'dpmpp_2m',
          id: ImageEditorSelectIds.Sampler,
          isMandatory: false,
          title: 'Sampler used for inpaint diffusion steps.',
          values: [
            { value: 'DPM++ 2M', id: 'dpmpp_2m' },
            { value: 'DPM++ 2M Karras', id: 'dpmpp_2m_karras' },
            { value: 'Euler', id: 'euler' },
            { value: 'Euler a', id: 'euler_ancestral' },
          ],
        },
        {
          ariaLabel: 'Scheduler',
          controlType: ImageEditorControls.Select,
          defaultValue: 'normal',
          id: ImageEditorSelectIds.Scheduler,
          isMandatory: false,
          title: 'Scheduler used for inpaint diffusion steps.',
          values: [
            { value: 'Normal', id: 'normal' },
            { value: 'Karras', id: 'karras' },
            { value: 'Exponential', id: 'exponential' },
          ],
        },
      ],
      [ImageEditorControls.Slider]: [
        {
          ariaLabel: 'Conditioning mix',
          controlType: ImageEditorControls.Slider,
          defaultValue: 0,
          id: ImageEditorSliderIds.ConditioningMix,
          isMandatory: false,
          max: '1',
          min: '-1',
          step: '0.1',
          title:
            'Conditioning mode: -1=input only, 0=concat, 1=prompts only. Intermediate values blend between input and prompts.',
        },
        {
          ariaLabel: 'Denoise percentage',
          controlType: ImageEditorControls.Slider,
          defaultValue: 40,
          id: ImageEditorSliderIds.DenoisePercentage,
          isMandatory: true,
          max: '100',
          min: '0',
          step: '1',
          title: 'Noise applied during inpaint. 0 keeps original pixels, 100 fully regenerates.',
        },
        {
          ariaLabel: 'CFG scale',
          controlType: ImageEditorControls.Slider,
          defaultValue: 7,
          id: ImageEditorSliderIds.Cfg,
          isMandatory: true,
          max: '30',
          min: '1',
          step: '0.5',
          title: 'Classifier-free guidance applied during the inpaint pass.',
        },
        {
          ariaLabel: 'Steps',
          controlType: ImageEditorControls.Slider,
          defaultValue: 16,
          id: ImageEditorSliderIds.Steps,
          isMandatory: true,
          max: '30',
          min: '1',
          step: '1',
          title: 'Diffusion steps used for the inpaint sampler.',
        },
        {
          ariaLabel: 'Upsample target (px)',
          controlType: ImageEditorControls.Slider,
          defaultValue: 2048,
          id: ImageEditorSliderIds.UpsampleTarget,
          isMandatory: false,
          max: '2048',
          min: '0',
          step: '16',
          title: 'Detailer path: upscale ROI longer side to this size before inpaint (0 disables).',
        },
        {
          ariaLabel: 'ROI padding (px)',
          controlType: ImageEditorControls.Slider,
          defaultValue: 32,
          id: ImageEditorSliderIds.RoiPadding,
          isMandatory: false,
          max: '256',
          min: '0',
          step: '1',
          title: 'Pixels of padding around the mask bounding box when cropping the ROI.',
        },
        {
          ariaLabel: 'ROI align multiple',
          controlType: ImageEditorControls.Slider,
          defaultValue: 8,
          id: ImageEditorSliderIds.RoiAlign,
          isMandatory: false,
          max: '64',
          min: '1',
          step: '1',
          title:
            'Align ROI size/position to this multiple. Keeps latent-friendly dims. Disable auto-align to use.',
        },
        {
          ariaLabel: 'ROI minimum size (px)',
          controlType: ImageEditorControls.Slider,
          defaultValue: 64,
          id: ImageEditorSliderIds.RoiMinSize,
          isMandatory: false,
          max: '1024',
          min: '1',
          step: '1',
          title: 'Enforce a minimum width/height for the cropped ROI.',
        },
        {
          ariaLabel: 'Dilate mask (px)',
          controlType: ImageEditorControls.Slider,
          defaultValue: 0,
          id: ImageEditorSliderIds.Dilate,
          isMandatory: false,
          max: '64',
          min: '0',
          step: '1',
          title: 'Expand mask edges before inpaint to avoid seams.',
        },
        {
          ariaLabel: 'Feather mask (px)',
          controlType: ImageEditorControls.Slider,
          defaultValue: 0,
          id: ImageEditorSliderIds.Feather,
          isMandatory: false,
          max: '64',
          min: '0',
          step: '1',
          title: 'Soften mask edges to blend the inpainted region.',
        },
      ],
      [ImageEditorControls.Textfield]: [
        {
          ariaLabel: 'Seed',
          controlType: ImageEditorControls.Textfield,
          defaultValue: '-1',
          id: ImageEditorTextfieldIds.Seed,
          isMandatory: false,
          title: 'Optional seed override. Leave at -1 for a random seed.',
          type: 'number',
        },
      ],
      [ImageEditorControls.Toggle]: [
        {
          ariaLabel: 'WD14 tagging',
          controlType: ImageEditorControls.Toggle,
          defaultValue: false,
          id: ImageEditorToggleIds.Wd14Tagging,
          isMandatory: false,
          off: 'false',
          on: 'true',
          title: 'Automatically tag the inpaint patch with WD14 and add tags to conditioning.',
        },
        {
          ariaLabel: 'Auto-align ROI',
          controlType: ImageEditorControls.Toggle,
          defaultValue: false,
          id: ImageEditorToggleIds.RoiAlignAuto,
          isMandatory: false,
          off: 'false',
          on: 'true',
          title:
            'Infer alignment multiple from VAE/model. Disable to set a manual multiple (see slider).',
        },
        {
          ariaLabel: 'Apply unsharp mask',
          controlType: ImageEditorControls.Toggle,
          defaultValue: true,
          id: ImageEditorToggleIds.ApplyUnsharpMask,
          isMandatory: false,
          off: 'false',
          on: 'true',
          title: 'Apply a gentle unsharp mask after downscaling the inpainted region.',
        },
      ],
    },
    layout: [
      {
        id: 'inpaint-conditioning',
        node: {
          id: 'inpaint-conditioning',
          value: 'Conditioning settings',
          description: 'Settings for conditioning (prompt).',
          icon: 'robot',
          cells: {
            lfSlot: {
              shape: 'slot',
              value: 'inpaint-conditioning',
            },
          },
        },
        children: [
          ImageEditorTextfieldIds.PositivePrompt,
          ImageEditorTextfieldIds.NegativePrompt,
          ImageEditorSliderIds.ConditioningMix,
          ImageEditorToggleIds.Wd14Tagging,
        ],
      },
      {
        id: 'inpaint-sampling',
        node: {
          id: 'inpaint-sampling',
          value: 'Sampling settings',
          description: 'Settings for sampling (Sampler, Scheduler, Steps,etc.).',
          icon: 'wand',
          cells: {
            lfSlot: {
              shape: 'slot',
              value: 'inpaint-sampling',
            },
          },
        },
        children: [
          ImageEditorSliderIds.DenoisePercentage,
          ImageEditorSelectIds.Sampler,
          ImageEditorSelectIds.Scheduler,
          ImageEditorSliderIds.Cfg,
          ImageEditorSliderIds.Steps,
          ImageEditorTextfieldIds.Seed,
        ],
      },
      {
        id: 'inpaint-roi',
        node: {
          id: 'inpaint-roi',
          value: 'ROI settings',
          description: 'Settings for region of interest (ROI).',
          icon: 'image-in-picture',
          cells: {
            lfSlot: {
              shape: 'slot',
              value: 'inpaint-roi',
            },
          },
        },
        children: [
          ImageEditorSliderIds.UpsampleTarget,
          ImageEditorToggleIds.ApplyUnsharpMask,
          ImageEditorSliderIds.Dilate,
          ImageEditorSliderIds.Feather,
          ImageEditorSliderIds.RoiPadding,
          ImageEditorSliderIds.RoiAlign,
          ImageEditorToggleIds.RoiAlignAuto,
          ImageEditorSliderIds.RoiMinSize,
        ],
      },
    ],
  },
  //#endregion

  //#region Outpaint
  [IMAGE_EDITOR_CONSTANTS.FILTERS.OUTPAINT]: {
    controlIds: ImageEditorInpaintIds,
    hasCanvasAction: true,
    settings: {
      apply_unsharp_mask: true,
      b64_canvas: '',
      cfg: 7,
      conditioning_mix: 0,
      denoise_percentage: 60,
      feather: 12,
      negative_prompt: '',
      positive_prompt: '',
      sampler: 'dpmpp_2m',
      scheduler: 'normal',
      steps: 24,
      upsample_target: 0,
      wd14_tagging: false,
      outpaint_amount: 256,
    },
    configs: {
      [ImageEditorControls.Multiinput]: [
        {
          ariaLabel: 'Positive prompt',
          controlType: ImageEditorControls.Multiinput,
          defaultValue: '',
          id: ImageEditorTextfieldIds.PositivePrompt,
          isMandatory: false,
          title: 'Prompt applied to the outpainted regions.',
          mode: 'tags',
          allowFreeInput: true,
        },
        {
          ariaLabel: 'Negative prompt',
          controlType: ImageEditorControls.Multiinput,
          defaultValue: '',
          id: ImageEditorTextfieldIds.NegativePrompt,
          isMandatory: false,
          title: 'Negative prompt applied to the outpainted regions.',
          mode: 'tags',
          allowFreeInput: true,
        },
      ],
      [ImageEditorControls.Toggle]: [
        {
          ariaLabel: 'WD14 tagging',
          controlType: ImageEditorControls.Toggle,
          defaultValue: false,
          id: ImageEditorToggleIds.Wd14Tagging,
          isMandatory: false,
          off: 'false',
          on: 'true',
          title: 'Automatically tag the outpaint patch with WD14 and add tags to conditioning.',
        },
      ],
      [ImageEditorControls.Slider]: [
        {
          ariaLabel: 'Denoise percentage',
          controlType: ImageEditorControls.Slider,
          defaultValue: 60,
          id: ImageEditorSliderIds.DenoisePercentage,
          isMandatory: true,
          max: '100',
          min: '0',
          step: '1',
          title:
            'Noise applied during outpaint. 0 keeps original pixels, 100 fully regenerates the band.',
        },
        {
          ariaLabel: 'Outpaint amount (px)',
          controlType: ImageEditorControls.Slider,
          defaultValue: 256,
          id: ImageEditorSliderIds.OutpaintAmount,
          isMandatory: true,
          max: '1024',
          min: '8',
          step: '8',
          title: 'Expand canvas by this many pixels on edges touched by the brush.',
        },
        {
          ariaLabel: 'Feather mask (px)',
          controlType: ImageEditorControls.Slider,
          defaultValue: 12,
          id: ImageEditorSliderIds.Feather,
          isMandatory: false,
          max: '64',
          min: '0',
          step: '1',
          title: 'Soften mask edges to blend the inpainted region.',
        },
        {
          ariaLabel: 'Conditioning mix',
          controlType: ImageEditorControls.Slider,
          defaultValue: 0,
          id: ImageEditorSliderIds.ConditioningMix,
          isMandatory: false,
          max: '1',
          min: '-1',
          step: '0.1',
          title:
            'Conditioning mode: -1=input only, 0=concat, 1=prompts only. Intermediate values blend between input and prompts.',
        },
        {
          ariaLabel: 'CFG scale',
          controlType: ImageEditorControls.Slider,
          defaultValue: 7,
          id: ImageEditorSliderIds.Cfg,
          isMandatory: true,
          max: '30',
          min: '1',
          step: '0.5',
          title: 'Classifier-free guidance applied during the outpaint pass.',
        },
        {
          ariaLabel: 'Steps',
          controlType: ImageEditorControls.Slider,
          defaultValue: 24,
          id: ImageEditorSliderIds.Steps,
          isMandatory: true,
          max: '50',
          min: '1',
          step: '1',
          title: 'Diffusion steps used when outpainting.',
        },
      ],
      [ImageEditorControls.Select]: [
        {
          ariaLabel: 'Sampler',
          controlType: ImageEditorControls.Select,
          defaultValue: 'dpmpp_2m',
          id: ImageEditorSelectIds.Sampler,
          isMandatory: false,
          title: 'Sampler used for outpaint diffusion steps.',
          values: [
            { value: 'DPM++ 2M', id: 'dpmpp_2m' },
            { value: 'DPM++ 2M Karras', id: 'dpmpp_2m_karras' },
            { value: 'Euler', id: 'euler' },
            { value: 'Euler a', id: 'euler_ancestral' },
          ],
        },
        {
          ariaLabel: 'Scheduler',
          controlType: ImageEditorControls.Select,
          defaultValue: 'normal',
          id: ImageEditorSelectIds.Scheduler,
          isMandatory: false,
          title: 'Scheduler used for outpaint diffusion steps.',
          values: [
            { value: 'Normal', id: 'normal' },
            { value: 'Karras', id: 'karras' },
            { value: 'Exponential', id: 'exponential' },
          ],
        },
      ],
    },
    layout: [
      {
        id: 'outpaint-conditioning',
        node: {
          id: 'outpaint-conditioning',
          value: 'Conditioning settings',
          description: 'Prompts and conditioning mix.',
          icon: 'robot',
          cells: {
            lfSlot: {
              shape: 'slot',
              value: 'outpaint-conditioning',
            },
          },
        },
        children: [
          ImageEditorTextfieldIds.PositivePrompt,
          ImageEditorTextfieldIds.NegativePrompt,
          ImageEditorSliderIds.ConditioningMix,
          ImageEditorToggleIds.Wd14Tagging,
        ],
      },
      {
        id: 'outpaint-sampling',
        node: {
          id: 'outpaint-sampling',
          value: 'Sampling settings',
          description: 'Sampler, scheduler, steps, denoise, CFG.',
          icon: 'wand',
          cells: {
            lfSlot: {
              shape: 'slot',
              value: 'outpaint-sampling',
            },
          },
        },
        children: [
          ImageEditorSliderIds.DenoisePercentage,
          ImageEditorSelectIds.Sampler,
          ImageEditorSelectIds.Scheduler,
          ImageEditorSliderIds.Cfg,
          ImageEditorSliderIds.Steps,
        ],
      },
      {
        id: 'outpaint-region',
        node: {
          id: 'outpaint-region',
          value: 'Region settings',
          description: 'How much to expand and edge softness.',
          icon: 'arrow-autofit-content',
          cells: {
            lfSlot: {
              shape: 'slot',
              value: 'outpaint-region',
            },
          },
        },
        children: [ImageEditorSliderIds.OutpaintAmount, ImageEditorSliderIds.Feather],
      },
    ],
  },
  //#endregion
};
