import { IMAGE_EDITOR_CONSTANTS } from '../../../helpers/imageEditor/constants';
import {
  ImageEditorControls,
  ImageEditorFilters,
  ImageEditorInpaintFilter,
  ImageEditorInpaintIds,
  ImageEditorSliderIds,
  ImageEditorTextfieldIds,
  ImageEditorToggleIds,
} from '../../../types/widgets/imageEditor';

export const DIFFUSION_SETTINGS: Pick<ImageEditorFilters, 'inpaint'> = {
  //#region Inpaint
  [IMAGE_EDITOR_CONSTANTS.FILTERS.INPAINT]: {
    controlIds: ImageEditorInpaintIds,
    hasCanvasAction: true,
    settings: {
      b64_canvas: '',
      cfg: 7,
      denoise_percentage: 40,
      steps: 16,
      positive_prompt: '',
      negative_prompt: '',
      upsample_target: 2048,
      use_conditioning: true,
      conditioning_mix: -1,
      apply_unsharp_mask: true,
    },
    configs: {
      [ImageEditorControls.Multiinput]: [
        {
          ariaLabel: 'Positive prompt',
          controlType: ImageEditorControls.Multiinput,
          defaultValue: '',
          id: ImageEditorTextfieldIds.PositivePrompt,
          isMandatory: false,
          title: 'Prompt applied to masked pixels.',
          mode: 'tags',
          allowFreeInput: true,
        },
        {
          ariaLabel: 'Negative prompt',
          controlType: ImageEditorControls.Multiinput,
          defaultValue: '',
          id: ImageEditorTextfieldIds.NegativePrompt,
          isMandatory: false,
          title: 'Negative prompt applied to masked pixels.',
          mode: 'tags',
          allowFreeInput: true,
        },
      ],
      [ImageEditorControls.Toggle]: [
        {
          ariaLabel: 'Use conditioning prompts',
          controlType: ImageEditorControls.Toggle,
          defaultValue: true,
          id: ImageEditorToggleIds.UseConditioning,
          isMandatory: false,
          off: 'false',
          on: 'true',
          title:
            'If enabled, prepend the connected conditioning inputs to the prompts before sampling.',
        },
      ],
      [ImageEditorControls.Slider]: [
        {
          ariaLabel: 'Conditioning mix',
          controlType: ImageEditorControls.Slider,
          defaultValue: -1,
          id: ImageEditorSliderIds.ConditioningMix,
          isMandatory: false,
          max: '1',
          min: '-1',
          step: '0.1',
          title:
            'Blend input conditioning (-1) with inpaint prompts (1). 0 keeps both contributions balanced.',
        },
        {
          ariaLabel: 'Denoise percentage',
          controlType: ImageEditorControls.Slider,
          defaultValue: 40,
          id: ImageEditorSliderIds.DenoisePercentage,
          isMandatory: true,
          max: '100',
          min: '0',
          step: '1',
          title: 'Noise applied during inpaint. 0 keeps original pixels, 100 fully regenerates.',
        },
        {
          ariaLabel: 'CFG scale',
          controlType: ImageEditorControls.Slider,
          defaultValue: 7,
          id: ImageEditorSliderIds.Cfg,
          isMandatory: true,
          max: '30',
          min: '1',
          step: '0.5',
          title: 'Classifier-free guidance applied during the inpaint pass.',
        },
        {
          ariaLabel: 'Steps',
          controlType: ImageEditorControls.Slider,
          defaultValue: 16,
          id: ImageEditorSliderIds.Steps,
          isMandatory: true,
          max: '30',
          min: '1',
          step: '1',
          title: 'Diffusion steps used for the inpaint sampler.',
        },
        {
          ariaLabel: 'Upsample target (px)',
          controlType: ImageEditorControls.Slider,
          defaultValue: 2048,
          id: ImageEditorSliderIds.UpsampleTarget,
          isMandatory: false,
          max: '2048',
          min: '0',
          step: '16',
          title: 'Detailer path: upscale ROI longer side to this size before inpaint (0 disables).',
        },
      ],
    },
  },
  //#endregion
};

export const INPAINT_ADV: ImageEditorInpaintFilter = {
  //#region Inpaint (adv.)
  controlIds: ImageEditorInpaintIds,
  hasCanvasAction: true,
  settings: {
    ...DIFFUSION_SETTINGS.inpaint!.settings,
    use_conditioning: false,
    conditioning_mix: 0,
    apply_unsharp_mask: true,
    roi_auto: true,
    roi_padding: 32,
    roi_align: 8,
    roi_align_auto: false,
    roi_min_size: 64,
    dilate: 0,
    feather: 0,
    seed: 42,
  },
  configs: {
    [ImageEditorControls.Multiinput]: [
      {
        ariaLabel: 'Positive prompt',
        controlType: ImageEditorControls.Multiinput,
        defaultValue: '',
        id: ImageEditorTextfieldIds.PositivePrompt,
        isMandatory: false,
        title: 'Prompt applied to masked pixels.',
        mode: 'tags',
        allowFreeInput: true,
      },
      {
        ariaLabel: 'Negative prompt',
        controlType: ImageEditorControls.Multiinput,
        defaultValue: '',
        id: ImageEditorTextfieldIds.NegativePrompt,
        isMandatory: false,
        title: 'Negative prompt applied to masked pixels.',
        mode: 'tags',
        allowFreeInput: true,
      },
    ],
    [ImageEditorControls.Textfield]: [
      {
        ariaLabel: 'Seed',
        controlType: ImageEditorControls.Textfield,
        defaultValue: '',
        id: ImageEditorTextfieldIds.Seed,
        isMandatory: false,
        title: 'Optional seed override. Leave blank for a random seed.',
        type: 'number',
      },
    ],
    [ImageEditorControls.Slider]: [
      {
        ariaLabel: 'Conditioning mix',
        controlType: ImageEditorControls.Slider,
        defaultValue: -1,
        id: ImageEditorSliderIds.ConditioningMix,
        isMandatory: false,
        max: '1',
        min: '-1',
        step: '0.1',
        title:
          'Blend input conditioning (-1) with inpaint prompts (1). 0 keeps both contributions balanced.',
      },
      {
        ariaLabel: 'Denoise percentage',
        controlType: ImageEditorControls.Slider,
        defaultValue: 40,
        id: ImageEditorSliderIds.DenoisePercentage,
        isMandatory: true,
        max: '100',
        min: '0',
        step: '1',
        title: 'Noise applied during inpaint. 0 keeps original pixels, 100 fully regenerates.',
      },
      {
        ariaLabel: 'CFG scale',
        controlType: ImageEditorControls.Slider,
        defaultValue: 7,
        id: ImageEditorSliderIds.Cfg,
        isMandatory: true,
        max: '30',
        min: '1',
        step: '0.5',
        title: 'Classifier-free guidance applied during the inpaint pass.',
      },
      {
        ariaLabel: 'Steps',
        controlType: ImageEditorControls.Slider,
        defaultValue: 16,
        id: ImageEditorSliderIds.Steps,
        isMandatory: true,
        max: '30',
        min: '1',
        step: '1',
        title: 'Diffusion steps used for the inpaint sampler.',
      },
      {
        ariaLabel: 'Upsample target (px)',
        controlType: ImageEditorControls.Slider,
        defaultValue: 2048,
        id: ImageEditorSliderIds.UpsampleTarget,
        isMandatory: false,
        max: '2048',
        min: '0',
        step: '16',
        title: 'Detailer path: upscale ROI longer side to this size before inpaint (0 disables).',
      },
      {
        ariaLabel: 'ROI padding (px)',
        controlType: ImageEditorControls.Slider,
        defaultValue: 32,
        id: ImageEditorSliderIds.RoiPadding,
        isMandatory: false,
        max: '256',
        min: '0',
        step: '1',
        title: 'Pixels of padding around the mask bounding box when cropping the ROI.',
      },
      {
        ariaLabel: 'ROI align multiple',
        controlType: ImageEditorControls.Slider,
        defaultValue: 8,
        id: ImageEditorSliderIds.RoiAlign,
        isMandatory: false,
        max: '64',
        min: '1',
        step: '1',
        title:
          'Align ROI size/position to this multiple. Keeps latent-friendly dims. Disable auto-align to use.',
      },
      {
        ariaLabel: 'ROI minimum size (px)',
        controlType: ImageEditorControls.Slider,
        defaultValue: 64,
        id: ImageEditorSliderIds.RoiMinSize,
        isMandatory: false,
        max: '1024',
        min: '1',
        step: '1',
        title: 'Enforce a minimum width/height for the cropped ROI.',
      },
      {
        ariaLabel: 'Dilate mask (px)',
        controlType: ImageEditorControls.Slider,
        defaultValue: 0,
        id: ImageEditorSliderIds.Dilate,
        isMandatory: false,
        max: '64',
        min: '0',
        step: '1',
        title: 'Expand mask edges before inpaint to avoid seams.',
      },
      {
        ariaLabel: 'Feather mask (px)',
        controlType: ImageEditorControls.Slider,
        defaultValue: 0,
        id: ImageEditorSliderIds.Feather,
        isMandatory: false,
        max: '64',
        min: '0',
        step: '1',
        title: 'Soften mask edges to blend the inpainted region.',
      },
    ],
    [ImageEditorControls.Toggle]: [
      {
        ariaLabel: 'Use conditioning prompts',
        controlType: ImageEditorControls.Toggle,
        defaultValue: false,
        id: ImageEditorToggleIds.UseConditioning,
        isMandatory: false,
        off: 'false',
        on: 'true',
        title:
          'If enabled, prepend the connected conditioning inputs to the prompts before sampling.',
      },
      {
        ariaLabel: 'Auto ROI crop',
        controlType: ImageEditorControls.Toggle,
        defaultValue: true,
        id: ImageEditorToggleIds.RoiAuto,
        isMandatory: false,
        off: 'false',
        on: 'true',
        title: 'Automatically crop to mask bounding box to speed up inpainting.',
      },
      {
        ariaLabel: 'Auto-align ROI',
        controlType: ImageEditorControls.Toggle,
        defaultValue: false,
        id: ImageEditorToggleIds.RoiAlignAuto,
        isMandatory: false,
        off: 'false',
        on: 'true',
        title:
          'Infer alignment multiple from VAE/model. Disable to set a manual multiple (see slider).',
      },
      {
        ariaLabel: 'Apply unsharp mask',
        controlType: ImageEditorControls.Toggle,
        defaultValue: true,
        id: ImageEditorToggleIds.ApplyUnsharpMask,
        isMandatory: false,
        off: 'false',
        on: 'true',
        title: 'Apply a gentle unsharp mask after downscaling the inpainted region.',
      },
    ],
  },
  //#endregion
};
